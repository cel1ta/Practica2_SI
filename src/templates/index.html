<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Cuadro de Mando Integral</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<h1>Cuadro de Mando Integral</h1>

<form method="POST">
    <label for="top_x">Seleccionar Top X:</label>
    <input type="number" id="top_x" name="top_x" value="{{ top_x }}" min="1">
    <label for="show_employees">Mostrar empleados:</label>
    <input type="checkbox" id="show_employees" name="show_employees" {% if show_employees %}checked{% endif %}>
    <button type="submit">Actualizar</button>
</form>

<h2>Top {{ top_x }} Clientes con Más Incidencias</h2>
<table border="1">
    <tr>
        <th>ID Cliente</th>
        <th>Número de Incidencias</th>
    </tr>
    {% for client in top_clients %}
    <tr>
        <td>{{ client['cliente'] }}</td>
        <td>{{ client['incident_count'] }}</td>
    </tr>
    {% endfor %}
</table>

<h2>Top {{ top_x }} Tipos de Incidencias por Tiempo de Resolución</h2>
<table border="1">
    <tr>
        <th>Tipo de Incidencia</th>
        <th>Tiempo Promedio de Resolución (Días)</th>
    </tr>
    {% for incident in top_incident_types %}
    <tr>
        <td>{{ incident['tipo_incidencia'] }}</td>
        <td>{{ incident['avg_resolution_days'] | round(2) }}</td>
    </tr>
    {% endfor %}
</table>

{% if show_employees and top_employees %}
<h2>Top {{ top_x }} Empleados por Tiempo Empleado</h2>
<table border="1">
    <tr>
        <th>ID Empleado</th>
        <th>Tiempo Total (Horas)</th>
    </tr>
    {% for employee in top_employees %}
    <tr>
        <td>{{ employee['id_emp'] }}</td>
        <td>{{ employee['total_time'] | round(2) }}</td>
    </tr>
    {% endfor %}
</table>
{% endif %}

<h2>Últimas 10 Vulnerabilidades (Tiempo Real)</h2>
{% if latest_cves %}
<table border="1">
    <tr>
        <th>CVE ID</th>
        <th>Descripción</th>
        <th>Fecha de Publicación</th>
        <th>Fecha de Actualización</th>
        <th>Puntaje CVE</th>
    </tr>
    {% for cve in latest_cves %}
    <tr>
        <td>{{ cve['cve_id'] }}</td>
        <td>{{ cve['description'] | truncate(100) }}</td>
        <td>{{ cve['published_date'] }}</td>
        <td>{{ cve['updated_date'] }}</td>
        <td>{{ cve['cve_score'] }}</td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>No se pudieron obtener vulnerabilidades en este momento.</p>
{% endif %}
</body>
</html>